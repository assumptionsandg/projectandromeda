<!DOCTYPE html>
<html>

<meta charset="UTF-8">

<link rel="stylesheet" type="text/css" href="loginstyle.css">

<title>Project Andromeda</title>

<div id='signDiv' class='sign'>
    <h1 id="github"><u>Project Andromeda</u></h1>
        <div class="column_center">
        <input id="signDiv-username" type="text" placeholder="Enter your username"></input>
        <input id="signDiv-password" type="password" placeholder="Enter your password"></input>
        <button id="signDiv-signIn" class="normal">Sign In</button>
        <button id="signDiv-signUp" class="normal">Sign Up</button>
        <button id="discord" class="normal">Join the Discord!</button>
        <p1>Represented by the RotD Community</p1>
        </div>
        <div class="column_bottom">
            <p2>Version 0.03 February 2020 "Slightly Less Oof" Build</p2>
            <p3>Computer Science Project Development Stage</p3>
        </div>
</div>

<body style='margin: 0px; background-color: #000000; overflow: hidden';></body>
<script type='module'>
    
import * as THREE from '/three.module.js'

let allupdate = []
let allmass = []
let allplanets = []
let allcount = [] 
let planetmass = []
let planetx = []
let planety = []
let planetz = []
let planetvx = []
let planetvy = []
let planetvz = []

let allx = []
let ally = []
let allz = []
let count=0
let pcount=0

allmass.fill(0)
allplanets.fill(0)
allx.fill(0)
ally.fill(0)
allz.fill(0)
planetx.fill(0)

class Star{
    constructor(mass,x,y,z,vx,vy,vz){
        this.mass=mass
        this.x=x
        this.y=y
        this.z=z
        this.vx=vx
        this.vy=vy
        this.vz=vz
     
        this.draw()
        this.update()
    }

    draw(){
        let self = this
        count=count+1
        this.geometry = new THREE.SphereGeometry(0.5,32,32)
        this.material = new THREE.MeshPhongMaterial({
            map:THREE.ImageUtils.loadTexture('images/sunmap.jpg')
        })
        this.mesh = new THREE.Mesh(this.geometry,this.material)
        // console.log(this.x)
        this.mesh.position.x=this.x
        this.mesh.position.y=this.y
        this.mesh.position.z=this.z
        allmass.push(this.mass)
        allmass.unshift(this.mass)
        allmass.pop()

        
        
        // console.log(this.mesh.position.x)
        // console.log(allmass)
    }

    update(){
        let self = this
        let resultantAx=0
        let resultantAy=0
        let resultantAz=0
        allx.push(self.x)
        ally.push(self.y)
        allz.push(self.z)
        allplanets.push(count)
        allplanets.push(0)

        allupdate.push(function(){
            allx.unshift(self.x)
            ally.unshift(self.y)
            allz.unshift(self.z)
            allx.pop()
            ally.pop()
            allz.pop()
            self.mesh.position.x+=self.vx
            self.mesh.position.y+=self.vy
            self.mesh.position.z+=self.vz
        })
    }

    getMesh(){
        return this.mesh
    }


}

class Sun extends Star{

}

class Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        this.mass=mass
        this.x=x
        this.y=y
        this.z=z
        this.vx=vx
        this.vy=vy
        this.vz=vz
        this.draw()
        this.update()
        pcount+=1

    }

    draw(){
        let self = this
        this.geometry = new THREE.SphereGeometry(0.5,32,32)
        this.material = new THREE.MeshPhongMaterial({
            map:this.texture,
            bumpMap:this.bump,
            bumpscale:this.bumpscale,
            specularMap:this.speccmap,
            specular:this.spec,
            tansparent:this.transparenty,
            opacity:this.opacitie,
            side:this.sidey
        })
        this.mesh = new THREE.Mesh(this.geometry,this.material)
        this.mesh.position.x=this.x
        this.mesh.position.y=this.y
        this.mesh.position.z=this.z
        
    }

    update(){
        let self = this
        let ax=0
        let ay=0
        let az=0
        let rAx=0
        let rAy=0
        let rAz=0
        let radii=0
        let gravConst=6.67e-11
       
        allupdate.push(function(){
        for(let i=2; i>-1; i--){
            if(allz[i]>self.mesh.position.z || ally[i]>self.mesh.position.y || allx[i]>self.mesh.position.x || allplanets[1]==0){
                radii=Math.sqrt(((self.mesh.position.x-allx[i])**2)+((self.mesh.position.y-ally[i])**2)+((self.mesh.position.z-allz[i])**2))
            }
            else{
                radii=-Math.sqrt(((self.mesh.position.x-allx[i])**2)+((self.mesh.position.y-ally[i])**2)+((self.mesh.position.z-allz[i])**2))
            }
            ax=-(gravConst*(allmass[i])*self.mesh.position.x)/radii**3
            ay=-(gravConst*(allmass[i])*self.mesh.position.y)/radii**3
            az=-(gravConst*(allmass[i])*self.mesh.position.z)/radii**3
            ax=ax*10000000
            ay=ay*10000000
            az=az*10000000
            rAx+=ax
            rAy+=ay
            rAz+=az
            // console.log(self.mesh.position.x)
            // console.log(self.mesh.position.y)
            // console.log(self.mesh.position.z)

        } 
            self.vx+=ax
            self.vy+=ay
            self.vz+=az
            self.mesh.position.x+=self.vx
            self.mesh.position.y+=self.vy
            self.mesh.position.z+=self.vz
        })
        
    }

    getMesh(){
        return this.mesh
    }

}

class Mercury extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/mercurymap.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/mercurybump.jpg')
        this.bumpscale=0.005
        this.draw()
        this.update()
    }
}

class Venus extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/venusmap.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/venusbump.jpg')
        this.bumpscale=0.005
        this.draw()
        this.update()
    }
}

class Earth extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/earthmap1k.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/earthbump1k.jpg')
        this.bumpscale=0.05
        this.speccmap=THREE.ImageUtils.loadTexture('images/earthspec1k.jpg')
        this.spec=new THREE.Color('grey')
        this.draw()
        this.update()
    }
}

class EarthCloud extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        let self=this
        
        self.canvasResult=document.createElement('canvas')
        self.canvasResult.width=1024
        self.canvasResult.height=512

        self.imageMap=new Image()
        self.imageMap.addEventListener('load', function(){
            self.canvasMap=document.createElement('canvas')
            self.canvasMap.width=self.imageMap.width
            self.canvasMap.height=self.imageMap.height
            self.contextMap=self.canvasMap.getContext('2d')
            self.contextMap.drawImage(self.imagemap,0,0)
            self.dataMap=contextMap.getImageData(0,0,self.canvasMap.width,self.canvasMap.height)
            
            self.imageTrans=new Image()
            self.imageTrans.addEventListener('load', function(){
                self.canvasTrans=docuemnt.createElement('canvas')
                self.canvasTrans.width=self.imageTrans.width
                self.canvasTrans.height=self.imageTrans.height
                self.contextTrans=self.canvasTrans.getContext('2d')
                self.contextTrans=drawImage(self.imageTrans,0,0)
                self.dataTrans=self.contextTrans.getImageData(0,0,self.canvasTrans.width,self.canvasTrans.height)
                self.dataResult=self.contextMap.createImageData(self.canvasMap.width,self.canvasMap.height)
                for(let y = 0, offset = 0; y < self.imageMap.height; y++){
                    for(let x = 0; x < self.imageMap.width; x++, offset += 4){
                        self.dataResult.data[offset+0]	= self.dataMap.data[offset+0]
                        self.dataResult.data[offset+1]	= self.dataMap.data[offset+1]
                        self.dataResult.data[offset+2]	= self.dataMap.data[offset+2]
                        self.dataResult.data[offset+3]	= 255 - self.dataTrans.data[offset+0]
                    }
                }
                self.contextResult.putImageData(self.dataResult,0,0)
                self.material.map.needsUpdate=true;
            })
            self.imageTrans.src='images/earthcloudmaptrans.jpg'
        },false)
        self.imageMap='images/earthcloudmap.jpg'

        self.texture=new THREE.Texture(self.canvasResult)
        self.sidey=THREE.DoubleSide
        self.transparenty=true
        self.opacitie=0.8
        self.draw()
        self.update()
    }
    
}

class Mars extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/marsmap1k.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/marsbump1k.jpg')
        this.bumpscale=0.05
        this.draw()
        this.update()
    }
}

class Jupiter extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/jupitermap.jpg')
        this.bumpmap=this.texture
        this.bumpscale=0.02
        this.draw()
        this.update()
    }
}

class Saturn extends Planet{

}

class Uranus extends Planet{

}

class Neptune extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        this.texture=THREE.ImageUtils.loadTexture('images/mercurymap.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/mercurybump.jpg')
        this.bumpscale=0.005
        this.draw()
        this.update()
    }
}

class Pluto extends Planet{
    constructor(mass,x,y,z,vx,vy,vz){
        super(mass,x,y,z,vx,vy,vz)
        this.texture=THREE.ImageUtils.loadTexture('images/mercurymap.jpg')
        this.bump=THREE.ImageUtils.loadTexture('images/mercurybump.jpg')
        this.bumpscale=0.005
        this.draw()
        this.update()
    }
}

class Atmosphere extends Planet{

}

class starField{
    constructor(){
        this.texture	= THREE.ImageUtils.loadTexture('images/galaxy_starfield.png')
        this.material	= new THREE.MeshBasicMaterial({
            map	: this.texture,
            side	: THREE.BackSide
        })
        this.geometry	= new THREE.SphereGeometry(100, 32, 32)
        this.mesh	= new THREE.Mesh(this.geometry,this.material)
    }

    getMesh(){
        return this.mesh
    }

}

class Andromeda{
    constructor(){
        this.renderer = new THREE.WebGLRenderer({
            antialias:true
        })
        this.renderer.setSize( window.innerWidth, window.innerHeight );

        this.scene = new THREE.Scene()
        this.camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000 )
       
        this.light	= new THREE.AmbientLight( 0x888888 )
        this.scene.add( this.light )
        this.light	= new THREE.DirectionalLight( 0xcccccc, 1 )
        this.light.position.set(0,0,0)
        this.scene.add( this.light )
        this.light.castShadow	= true
        this.light.shadowCameraNear	= 0.01
        this.light.shadowCameraFar	= 15
        this.light.shadowCameraFov	= 45

        this.light.shadowCameraLeft	= -1
        this.light.shadowCameraRight	=  1
        this.light.shadowCameraTop	=  1
        this.light.shadowCameraBottom= -1
        this.camera.lookAt(0,0,0)
        this.camera.position.z=-5
        this.camera.position.x=10

        this.light.shadowBias	= 0.001
        this.light.shadowDarkness	= 0.2

        this.light.shadowMapWidth	= 1024*2
        this.light.shadowMapHeight	= 1024*2


        let self = this

        self.vector = {x:1,y:1}

        /*

        document.addEventListener('mousemove', function(event){
            self.vector.x	= (event.clientX/window.innerWidth ) - 0.1
            self.vector.y	= (event.clientY/window.innerHeight) - 0.1
        }, false)

        */

        allupdate.push(function(delta, now){
            self.camera.position.x += (self.vector.x*10 - (self.camera.position.x)) * (delta*3)
            self.camera.position.y += (self.vector.y*10 - self.camera.position.y) * (delta*3)
            self.camera.lookAt(0,0,0)
            return delta;
        })

        allupdate.push(function(){
            self.renderer.render( self.scene, self.camera );
        })


        let lastTimeMsec= null
        requestAnimationFrame(function animate(nowMsec){
            requestAnimationFrame( animate );

            lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
            let deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
            lastTimeMsec	= nowMsec

            allupdate.forEach(function(updateFn){
                updateFn(deltaMsec/1000, nowMsec/1000)
            })
        })

    }
    
    addtoPage(){
        document.body.appendChild(this.renderer.domElement)
    }

    add(mesh, delta, update){
        let world = mesh.getMesh()
        let self = this
        self.scene.add(mesh.getMesh());
        console.log(allx)
        console.log(ally)
        console.log(allz)
        console.log(allmass)
        console.log(allplanets)
    }

    
        
    
}


let simStart = new Andromeda()
simStart.addtoPage()
simStart.add(new starField())
simStart.add(new Star(10,0,0,0,0,0,0))
simStart.add(new Earth(10,-5,1,1,0.001,0.001,0.03))
simStart.add(new Mars(10,5,-1,-1,-0.001,-0.001,-0.03))
simStart.add(new Jupiter(10,0,5,-1,0.001,0.001,0.03))

/*
setInterval(function(){
    console.log(planetx)
    console.log(planety)
    console.log(planetz)
    console.log(planetvx)
    console.log(planetvy)
    console.log(planetvz)
}, 1000);
*/


</script>
</body>
</html>